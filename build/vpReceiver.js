(()=>{"use strict";const t=t=>{if(!t)return"00:00";let e=Math.floor(t/3600),s=Math.floor((t-3600*e)/60),i=Math.floor(t%60);return e?e.toString().padStart(2,"0")+":"+s.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0"):s.toString().padStart(2,"0")+":"+i.toString().padStart(2,"0")};function e(e,s){let i=new class{constructor(e,s){this.context=null,this.playerManager=null,this.castDebugLogger=null,this.appId=s.appId,this.audio=document.querySelector(e),this.playbackConfig=null,this.controls=null,this.hls=null,this.audioObject={},this.audioContainer=this.audio.parentElement,this.playbackRate=1,this.autoplay=!1,this.receiverControls=new class{constructor(e){this.seekbar=new class{constructor(t){this.element=document.querySelector(t),this.castdebugger=null,this.show=!1}setCastDebugger(t){this.castdebugger=t}setProgress(t,e){this.element.style.width=t/e*100+"%"}showHide(t){this.castdebugger.debug("showHide",`${t} ${this.show}`),this.show?this.element.parentElement.style.display="block":setTimeout((()=>{this.element.parentElement.style.display="none"}),t)}}(".seekbar-progress"),this.timer=new class{constructor(t){this.element=document.querySelector(t),this.element.textContent="00:00 / 00:00"}update(e,s){this.element.textContent=`${t(e)} /${t(s)}`}}(".timer"),this.castDebugger=null,this.element=document.querySelector(e),this.show=!0,this.loader=document.querySelector(".loader"),this.playIcon=document.querySelector(".vp-icon-play"),this.pauseIcon=document.querySelector(".vp-icon-pause")}setCastDebugger(t){this.castDebugger=t,this.seekbar.setCastDebugger(this.castDebugger)}pause(){this.pauseIcon.style.display="none",this.playIcon.style.display="block",setTimeout((()=>{this.playIcon.style.display="none"}),2e3)}play(){this.playIcon.style.display="none",this.pauseIcon.style.display="block",setTimeout((()=>{this.pauseIcon.style.display="none"}),2e3)}update(t){console.log(t),this.seekbar.setProgress(t.currentTime,t.duration),this.timer.update(t.currentTime,t.duration)}hideControls(t){this.show=!1,this.showHide(t||5e3)}showControls(){this.show=!0,this.showHide(10)}showHide(t){this.show?this.element.style.display="flex":setTimeout((()=>{this.element.style.display="none"}),t)}}(".controls"),this.mediaManager=null,this.castReceiverManager=null,this.audioStarted=!1}start(){this.receiverControls.loader.style.display="none",this.onPlay()}onPlay(){this.audio.play().then((()=>{this.audioStarted?this.receiverControls.play():(this.receiverControls.showControls(),this.audioStarted=!0),this.receiverControls.hideControls(6e3)})).catch((()=>{}))}onPause(){this.audio.pause(),this.receiverControls.pause(),this.receiverControls.showControls()}addPlayerEvents(){this.audio.addEventListener("timeupdate",this.onTimeUpdate)}onTimeUpdate(){this.receiverControls.update(this.updatePlayerState())}updatePlayerState(){return{currentTime:this.audio.currentTime,duration:this.audioObject.duration}}attachMedia(){if(vpReceiver.HLSsupported=Hls.isSupported(),this.castDebugLogger.debug("inside attach media",vpReceiver.HLSsupported),this.audio.playbackRate=1,this.castDebugLogger.debug("audio file",JSON.stringify(this.audio,["id","className","tagName"])),this.audioObject.file.endsWith("mp3"))this.castDebugLogger.debug("inside mp3",this.audioObject.file),this.audio.src=this.audioObject.file,this.start();else if(vpReceiver.HLSsupported){this.castDebugLogger.debug("inside hlssupported",this.audioObject.file);try{this.hls=new Hls,this.castDebugLogger.debug("hls initialized",this.audioObject.file),this.currentTime>0&&(this.audio.currentTime=this.currentTime),this.hls.attachMedia(this.audio),this.castDebugLogger.debug("attached media",this.audioObject.file),this.hls.on(Hls.Events.MEDIA_ATTACHED,(()=>{this.castDebugLogger.debug("amedia attached",this.audioObject.file),this.hls.startLevel=0,this.castDebugLogger.debug("loading source hlssupported",this.audioObject.file),this.hls.loadSource(this.audioObject.file)})),this.hls.on(Hls.Events.MANIFEST_PARSED,((t,e)=>{this.castDebugLogger.debug("manifest parsed",this.audioObject.file),this.start()})),this.hls.on(Hls.Events.ERROR,((t,e)=>{this.castDebugLogger.debug("HLS  ERROR",e.details)}))}catch(t){this.castDebugLogger.debug("hls error",t)}}this.castDebugLogger.debug("finished attach media")}fakeinit(){const t=cast.framework.CastReceiverContext.getInstance();t.getPlayerManager(),this.castDebugLogger={debug:function(t,e){console.debug(t,e)}},this.receiverControls.setCastDebugger(this.castDebugLogger),this.audioObject.file="https://vp.gjirafa.net/vps/prod/odgehtyo/encode/vjsmylds/mp3/360p.mp3",this.attachMedia(),this.bindMethods(),this.addPlayerEvents(),t.start()}init(){this.context=cast.framework.CastReceiverContext.getInstance(),this.context.setLoggerLevel(cast.framework.LoggerLevel.DEBUG),this.playerManager=this.context.getPlayerManager(),this.playerManager.setMediaElement(this.audio),this.castDebugLogger=cast.debug.CastDebugLogger.getInstance(),this.castDebugLogger.setEnabled(!0),this.castDebugLogger.debug("hello","okej"),this.receiverControls.setCastDebugger(this.castDebugLogger),this.context.start(),this.bindMethods(),this.bindInterceptors(),this.addPlayerEvents()}onSeek(t){this.audio.currentTime=t.currentTime,this.receiverControls.showControls(),this.receiverControls.hideControls(6e3),this.receiverControls.update(this.updatePlayerState())}drawButtons(){this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_SECONDARY_1,cast.framework.ui.ControlsButton.QUEUE_PREV),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_PRIMARY_1,cast.framework.ui.ControlsButton.CAPTIONS),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_PRIMARY_2,cast.framework.ui.ControlsButton.SEEK_FORWARD_15),this.controls.assignButton(cast.framework.ui.ControlsSlot.SLOT_SECONDARY_2,cast.framework.ui.ControlsButton.QUEUE_NEXT)}bindInterceptors(){this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD,this.onLoadRequest.bind(this)),this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.PLAY,this.onPlay.bind(this)),this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.PAUSE,this.onPause.bind(this)),this.playerManager.setMessageInterceptor(cast.framework.messages.MessageType.SEEK,this.onSeek.bind(this))}bindMethods(){this.bindInterceptors=this.bindInterceptors.bind(this),this.onLoadRequest=this.onLoadRequest.bind(this),this.attachMedia=this.attachMedia.bind(this),this.start=this.start.bind(this),this.addPlayerEvents=this.addPlayerEvents.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onPlay=this.onPlay.bind(this),this.onPause=this.onPause.bind(this),this.updatePlayerState=this.updatePlayerState.bind(this)}onLoadRequest(t){return this.castDebugLogger.debug("VPreceiver",t.media.contentId),this.castDebugLogger.debug("VPreceiver1",Hls.isSupported()),this.audioObject.file=t.media.contentId,this.audioObject.duration=t.media.metadata.duration,this.currentTime=t.currentTime,this.playbackRate=t.playbackRate,this.autoplay=t.autoplay,this.attachMedia(),null}addBreaks(t){return castDebugLogger.debug(LOG_RECEIVER_TAG,"addBreaks: "+JSON.stringify(t)),fetchMediaById("fbb_ad").then((e=>{t.breakClips=[{id:"fbb_ad",title:e.title,contentUrl:e.stream.dash,contentType:"application/dash+xml",whenSkippable:5}],t.breaks=[{id:"pre-roll",breakClipIds:["fbb_ad"],position:0}]}))}fetchMediaById(t){return castDebugLogger.debug(LOG_RECEIVER_TAG,"fetching id: "+t),new Promise(((e,s)=>{fetch(CONTENT_URL).then((t=>t.json())).then((i=>{i?i[t]?e(i[t]):s(`${t} not found in repository`):s("Content repository not found.")}))}))}}(e,s);return i.init(),i}e.HLSsupported=!1,window.vpReceiver=e})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUM1QjdGLE1BQU04RixJQUNEQSxFQUNFQSxFQUFJdEosR0FDTmdKLEVBQU9NLEVBQUl0SixJQUVYaUosRUFBUSxHQUFFakosNkJBR1ppSixFQUFPLHlDRC9YV2pKLEVBQUlDLEdBRWhDLE9BREFDLEVBQVMwRixPQUNGMUYsRUFMVEgsRUFBV2lFLGNBQWUsRUFRMUJ1RixPQUFPeEosV0FBYUEsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3ZwLXJlY2VpdmVyLy4vc3JjL2pzL21vZGVscy9zZWVrYmFyLmpzIiwid2VicGFjazovL3ZwLXJlY2VpdmVyLy4vc3JjL2pzL2hlbHBlcnMvVXRpbHMuanMiLCJ3ZWJwYWNrOi8vdnAtcmVjZWl2ZXIvLi9zcmMvanMvdnBSZWNlaXZlci5qcyIsIndlYnBhY2s6Ly92cC1yZWNlaXZlci8uL3NyYy9qcy9tb2RlbHMvcmVjZWl2ZXIuanMiLCJ3ZWJwYWNrOi8vdnAtcmVjZWl2ZXIvLi9zcmMvanMvbW9kZWxzL3JlY2VpdmVyLWNvbnRyb2xzLmpzIiwid2VicGFjazovL3ZwLXJlY2VpdmVyLy4vc3JjL2pzL21vZGVscy90aW1lci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTZWVrQmFyIHtcclxuICBjb25zdHJ1Y3RvcihpZCkge1xyXG4gICAgdGhpcy5lbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihpZCk7XHJcbiAgICB0aGlzLmNhc3RkZWJ1Z2dlciA9IG51bGw7XHJcbiAgICB0aGlzLnNob3cgPSBmYWxzZTtcclxuICB9XHJcbiAgc2V0Q2FzdERlYnVnZ2VyKGNhc3RkZWJ1Z2dlcikge1xyXG4gICAgdGhpcy5jYXN0ZGVidWdnZXIgPSBjYXN0ZGVidWdnZXI7XHJcbiAgfVxyXG4gIHNldFByb2dyZXNzKHRpbWUsIGR1cmF0aW9uKSB7XHJcbiAgICAvLyB0aGlzLmNhc3RkZWJ1Z2dlci5kZWJ1ZyhcImVsZVwiLCBKU09OLnN0cmluZ2lmeSh0aGlzLmVsZW1lbnQpKTtcclxuICAgIHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9ICh0aW1lIC8gZHVyYXRpb24pICogMTAwICsgXCIlXCI7XHJcbiAgICAvLyB0aGlzLmNhc3RkZWJ1Z2dlci5kZWJ1ZyhcIndpZHRoXCIsIHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCk7XHJcbiAgfVxyXG5cclxuICBzaG93SGlkZSh0aW1pbmcpIHtcclxuICAgIHRoaXMuY2FzdGRlYnVnZ2VyLmRlYnVnKFwic2hvd0hpZGVcIiwgYCR7dGltaW5nfSAke3RoaXMuc2hvd31gKTtcclxuICAgIGlmICh0aGlzLnNob3cpIHtcclxuICAgICAgdGhpcy5lbGVtZW50LnBhcmVudEVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnRFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgfSwgdGltaW5nKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFNlZWtCYXI7XHJcbiIsImNvbnN0IGZvcm1hdFRpbWUgPSAodGltZSkgPT4ge1xyXG4gIGlmICghdGltZSkgcmV0dXJuIFwiMDA6MDBcIjtcclxuXHJcbiAgbGV0IGhvdXJzID0gTWF0aC5mbG9vcih0aW1lIC8gMzYwMCk7XHJcbiAgbGV0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKCh0aW1lIC0gaG91cnMgKiAzNjAwKSAvIDYwKTtcclxuICBsZXQgc2Vjb25kcyA9IE1hdGguZmxvb3IodGltZSAlIDYwKTtcclxuXHJcbiAgLy8gZm9ybWF0IHRoZSBtaW51dGVzIGFuZCBzZWNvbmRzIHN0cmluZyB0byBsb29rIGNvbnNpc3RlbnQgYWNyb3NzIGFsbCB2YWx1ZXNcclxuICBpZiAoIWhvdXJzKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBtaW51dGVzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpICtcclxuICAgICAgXCI6XCIgK1xyXG4gICAgICBzZWNvbmRzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIChcclxuICAgIGhvdXJzLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpICtcclxuICAgIFwiOlwiICtcclxuICAgIG1pbnV0ZXMudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIikgK1xyXG4gICAgXCI6XCIgK1xyXG4gICAgc2Vjb25kcy50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKVxyXG4gICk7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgZm9ybWF0VGltZSxcclxufTtcclxuIiwiaW1wb3J0IFJlY2VpdmVyIGZyb20gXCIuL21vZGVscy9yZWNlaXZlclwiO1xyXG5cclxuLy9hIGJvb2xlYW4gdGVsbGluZyB3aGV0aGVyIEhMUyBpcyBzdXBwb3J0ZWQgaW4gdGhlIGJyb3dzZXJcclxudnBSZWNlaXZlci5ITFNzdXBwb3J0ZWQgPSBmYWxzZTtcclxuXHJcbmZ1bmN0aW9uIHZwUmVjZWl2ZXIoaWQsIGNvbmZpZykge1xyXG4gIGxldCByZWNlaXZlciA9IG5ldyBSZWNlaXZlcihpZCwgY29uZmlnKTtcclxuICByZWNlaXZlci5pbml0KCk7XHJcbiAgcmV0dXJuIHJlY2VpdmVyO1xyXG59XHJcblxyXG53aW5kb3cudnBSZWNlaXZlciA9IHZwUmVjZWl2ZXI7XHJcbiIsImltcG9ydCBobHNjb25maWcgZnJvbSBcIi4uL2NvbmZpZy9obHNDb25maWdcIjtcclxuaW1wb3J0IFJlY2VpdmVyQ29udHJvbHMgZnJvbSBcIi4vcmVjZWl2ZXItY29udHJvbHNcIjtcclxuY2xhc3MgUmVjZWl2ZXIge1xyXG4gIGNvbnN0cnVjdG9yKGlkLCBjb25maWcpIHtcclxuICAgIHRoaXMuY29udGV4dCA9IG51bGw7XHJcbiAgICB0aGlzLnBsYXllck1hbmFnZXIgPSBudWxsO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIgPSBudWxsO1xyXG4gICAgdGhpcy5hcHBJZCA9IGNvbmZpZy5hcHBJZDtcclxuICAgIHRoaXMuYXVkaW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkKTtcclxuICAgIHRoaXMucGxheWJhY2tDb25maWcgPSBudWxsO1xyXG4gICAgdGhpcy5jb250cm9scyA9IG51bGw7XHJcbiAgICB0aGlzLmhscyA9IG51bGw7XHJcbiAgICB0aGlzLmF1ZGlvT2JqZWN0ID0ge307XHJcbiAgICB0aGlzLmF1ZGlvQ29udGFpbmVyID0gdGhpcy5hdWRpby5wYXJlbnRFbGVtZW50O1xyXG4gICAgdGhpcy5wbGF5YmFja1JhdGUgPSAxO1xyXG4gICAgdGhpcy5hdXRvcGxheSA9IGZhbHNlO1xyXG4gICAgdGhpcy5yZWNlaXZlckNvbnRyb2xzID0gbmV3IFJlY2VpdmVyQ29udHJvbHMoXCIuY29udHJvbHNcIik7XHJcbiAgICB0aGlzLm1lZGlhTWFuYWdlciA9IG51bGw7XHJcbiAgICB0aGlzLmNhc3RSZWNlaXZlck1hbmFnZXIgPSBudWxsO1xyXG4gICAgdGhpcy5hdWRpb1N0YXJ0ZWQgPSBmYWxzZTtcclxuICB9XHJcbiAgc3RhcnQoKSB7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMubG9hZGVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIHRoaXMub25QbGF5KCk7XHJcbiAgfVxyXG5cclxuICBvblBsYXkoKSB7XHJcbiAgICAvLyByZXR1cm4gdGhpcy5wbGF5ZXJNYW5hZ2VyLnBsYXkoKTtcclxuICAgIHRoaXMuYXVkaW9cclxuICAgICAgLnBsYXkoKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmF1ZGlvU3RhcnRlZCkge1xyXG4gICAgICAgICAgdGhpcy5yZWNlaXZlckNvbnRyb2xzLnNob3dDb250cm9scygpO1xyXG4gICAgICAgICAgdGhpcy5hdWRpb1N0YXJ0ZWQgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMucGxheSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMuaGlkZUNvbnRyb2xzKDYwMDApO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKCkgPT4ge30pO1xyXG4gIH1cclxuICBvblBhdXNlKCkge1xyXG4gICAgdGhpcy5hdWRpby5wYXVzZSgpO1xyXG4gICAgdGhpcy5yZWNlaXZlckNvbnRyb2xzLnBhdXNlKCk7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMuc2hvd0NvbnRyb2xzKCk7XHJcbiAgfVxyXG4gIGFkZFBsYXllckV2ZW50cygpIHtcclxuICAgIHRoaXMuYXVkaW8uYWRkRXZlbnRMaXN0ZW5lcihcInRpbWV1cGRhdGVcIiwgdGhpcy5vblRpbWVVcGRhdGUpO1xyXG4gIH1cclxuICBvblRpbWVVcGRhdGUoKSB7XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMudXBkYXRlKHRoaXMudXBkYXRlUGxheWVyU3RhdGUoKSk7XHJcbiAgfVxyXG4gIHVwZGF0ZVBsYXllclN0YXRlKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY3VycmVudFRpbWU6IHRoaXMuYXVkaW8uY3VycmVudFRpbWUsXHJcbiAgICAgIGR1cmF0aW9uOiB0aGlzLmF1ZGlvT2JqZWN0LmR1cmF0aW9uLFxyXG4gICAgfTtcclxuICB9XHJcbiAgYXR0YWNoTWVkaWEoKSB7XHJcbiAgICB2cFJlY2VpdmVyLkhMU3N1cHBvcnRlZCA9IEhscy5pc1N1cHBvcnRlZCgpO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJpbnNpZGUgYXR0YWNoIG1lZGlhXCIsIHZwUmVjZWl2ZXIuSExTc3VwcG9ydGVkKTtcclxuICAgIHRoaXMuYXVkaW8ucGxheWJhY2tSYXRlID0gMTtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFxyXG4gICAgICBcImF1ZGlvIGZpbGVcIixcclxuICAgICAgSlNPTi5zdHJpbmdpZnkodGhpcy5hdWRpbywgW1wiaWRcIiwgXCJjbGFzc05hbWVcIiwgXCJ0YWdOYW1lXCJdKVxyXG4gICAgKTtcclxuICAgIGlmICh0aGlzLmF1ZGlvT2JqZWN0LmZpbGUuZW5kc1dpdGgoXCJtcDNcIikpIHtcclxuICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJpbnNpZGUgbXAzXCIsIHRoaXMuYXVkaW9PYmplY3QuZmlsZSk7XHJcbiAgICAgIHRoaXMuYXVkaW8uc3JjID0gdGhpcy5hdWRpb09iamVjdC5maWxlO1xyXG4gICAgICB0aGlzLnN0YXJ0KCk7XHJcbiAgICB9IGVsc2UgaWYgKHZwUmVjZWl2ZXIuSExTc3VwcG9ydGVkKSB7XHJcbiAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiaW5zaWRlIGhsc3N1cHBvcnRlZFwiLCB0aGlzLmF1ZGlvT2JqZWN0LmZpbGUpO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHRoaXMuaGxzID0gbmV3IEhscygpO1xyXG4gICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiaGxzIGluaXRpYWxpemVkXCIsIHRoaXMuYXVkaW9PYmplY3QuZmlsZSk7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFRpbWUgPiAwKSB0aGlzLmF1ZGlvLmN1cnJlbnRUaW1lID0gdGhpcy5jdXJyZW50VGltZTtcclxuICAgICAgICB0aGlzLmhscy5hdHRhY2hNZWRpYSh0aGlzLmF1ZGlvKTtcclxuICAgICAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhcImF0dGFjaGVkIG1lZGlhXCIsIHRoaXMuYXVkaW9PYmplY3QuZmlsZSk7XHJcblxyXG4gICAgICAgIHRoaXMuaGxzLm9uKEhscy5FdmVudHMuTUVESUFfQVRUQUNIRUQsICgpID0+IHtcclxuICAgICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiYW1lZGlhIGF0dGFjaGVkXCIsIHRoaXMuYXVkaW9PYmplY3QuZmlsZSk7XHJcbiAgICAgICAgICB0aGlzLmhscy5zdGFydExldmVsID0gMDtcclxuICAgICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFxyXG4gICAgICAgICAgICBcImxvYWRpbmcgc291cmNlIGhsc3N1cHBvcnRlZFwiLFxyXG4gICAgICAgICAgICB0aGlzLmF1ZGlvT2JqZWN0LmZpbGVcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICB0aGlzLmhscy5sb2FkU291cmNlKHRoaXMuYXVkaW9PYmplY3QuZmlsZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5obHMub24oSGxzLkV2ZW50cy5NQU5JRkVTVF9QQVJTRUQsIChldmVudCwgZGF0YSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJtYW5pZmVzdCBwYXJzZWRcIiwgdGhpcy5hdWRpb09iamVjdC5maWxlKTtcclxuICAgICAgICAgIHRoaXMuc3RhcnQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmhscy5vbihIbHMuRXZlbnRzLkVSUk9SLCAoZXZlbnQsIGRhdGEpID0+IHtcclxuICAgICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiSExTICBFUlJPUlwiLCBkYXRhLmRldGFpbHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiaGxzIGVycm9yXCIsIGVycm9yKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gdGhpcy5obHMub24oSGxzLkV2ZW50cy5FUlJPUiwgKGV2ZW50LCBkYXRhKSA9PiB7XHJcbiAgICAgIC8vICAgaWYgKGRhdGEuZGV0YWlscyA9PT0gXCJtYW5pZmVzdExvYWRFcnJvclwiKSB7XHJcbiAgICAgIC8vICAgICB0aGlzLmF1ZGlvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLmhpZGVDb250ZW50KTtcclxuICAgICAgLy8gICAgIHRoaXMuYXVkaW9Db250YWluZXIuY2xhc3NMaXN0LmFkZChjc3NDbGFzc2VzLmVmZmVjdHMuc2hvd0Vycm9yKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwibWFuaWZlc3RMb2FkVGltZU91dFwiKSB7XHJcbiAgICAgIC8vICAgICB0aGlzLmF1ZGlvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLmhpZGVDb250ZW50KTtcclxuICAgICAgLy8gICAgIHRoaXMuYXVkaW9Db250YWluZXIuY2xhc3NMaXN0LmFkZChjc3NDbGFzc2VzLmVmZmVjdHMuc2hvd0Vycm9yKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwibWFuaWZlc3RQYXJzaW5nRXJyb3JcIikge1xyXG4gICAgICAvLyAgICAgdGhpcy5hdWRpb0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNzc0NsYXNzZXMuZWZmZWN0cy5oaWRlQ29udGVudCk7XHJcbiAgICAgIC8vICAgICB0aGlzLmF1ZGlvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY3NzQ2xhc3Nlcy5lZmZlY3RzLnNob3dFcnJvcik7XHJcbiAgICAgIC8vICAgfVxyXG5cclxuICAgICAgLy8gICBpZiAoZGF0YS5kZXRhaWxzID09PSBcImxldmVsTG9hZEVycm9yXCIpIHtcclxuICAgICAgLy8gICAgIHRoaXMucmVtb3ZlTGV2ZWwoZGF0YS5jb250ZXh0LmxldmVsKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmIChkYXRhLmRldGFpbHMgPT09IFwiZnJhZ0xvYWRFcnJvclwiKSB7XHJcbiAgICAgIC8vICAgICB0aGlzLmZyYWdFcnJvckNvdW50Kys7XHJcbiAgICAgIC8vICAgICAvLyBzbiByZWZlcmVzIHRvIHNlcXVlbmNlIG51bWJlclxyXG4gICAgICAvLyAgICAgaWYgKGRhdGEuZnJhZy5zbiA9PSAwKSB0aGlzLmZhaWxlZFRvTG9hZEZpcnN0RnJhZ21lbnQgPSB0cnVlO1xyXG4gICAgICAvLyAgIH1cclxuXHJcbiAgICAgIC8vICAgaWYgKHRoaXMubGV2ZWxIYXNNaXNzaW5nRnJhZ21lbnRzKCkpIHtcclxuICAgICAgLy8gICAgIHRoaXMuZnJhZ0Vycm9yQ291bnQgPSAwO1xyXG4gICAgICAvLyAgICAgdGhpcy5yZW1vdmVMZXZlbChkYXRhLmZyYWcubGV2ZWwpO1xyXG4gICAgICAvLyAgICAgdGhpcy5obHMubG9hZExldmVsID0gLTE7XHJcbiAgICAgIC8vICAgICBjb25zb2xlLmxvZyhcIk5ldHdvcmsgZXJyb3IgZW5jb3VudGVyZWRcIik7XHJcbiAgICAgIC8vICAgfVxyXG5cclxuICAgICAgLy8gICBpZiAodGhpcy5mYWlsZWRUb0xvYWRGaXJzdEZyYWdtZW50KSB7XHJcbiAgICAgIC8vICAgICB0aGlzLmZhaWxlZFRvTG9hZEZpcnN0RnJhZ21lbnQgPSBmYWxzZTtcclxuICAgICAgLy8gICAgIHRoaXMucmVtb3ZlTGV2ZWwoZGF0YS5mcmFnLmxldmVsKTtcclxuICAgICAgLy8gICAgIHRoaXMuaGxzLmxvYWRMZXZlbCA9IC0xO1xyXG4gICAgICAvLyAgICAgdGhpcy5vblBsYXkoKTtcclxuICAgICAgLy8gICAgIGNvbnNvbGUubG9nKFwiTmV0d29yayBlcnJvciBlbmNvdW50ZXJlZFwiKTtcclxuICAgICAgLy8gICB9XHJcblxyXG4gICAgICAvLyAgIGlmICghZGF0YS5mYXRhbCkge1xyXG4gICAgICAvLyAgICAgcmV0dXJuO1xyXG4gICAgICAvLyAgIH1cclxuXHJcbiAgICAgIC8vICAgc3dpdGNoIChkYXRhLnR5cGUpIHtcclxuICAgICAgLy8gICAgIGNhc2UgSGxzLkVycm9yVHlwZXMuTkVUV09SS19FUlJPUjpcclxuICAgICAgLy8gICAgICAgY29uc29sZS5sb2coXCJmYXRhbCBuZXR3b3JrIGVycm9yIGVuY291bnRlcmVkXCIpO1xyXG4gICAgICAvLyAgICAgICB0aGlzLmhscy5zdGFydExvYWQoKTtcclxuICAgICAgLy8gICAgICAgYnJlYWs7XHJcbiAgICAgIC8vICAgICBjYXNlIEhscy5FcnJvclR5cGVzLk1FRElBX0VSUk9SOlxyXG4gICAgICAvLyAgICAgICBjb25zb2xlLmxvZyhcImZhdGFsIG1lZGlhIGVycm9yIGVuY291bnRlcmVkXCIpO1xyXG4gICAgICAvLyAgICAgICB0aGlzLmhscy5yZWNvdmVyTWVkaWFFcnJvcigpO1xyXG4gICAgICAvLyAgICAgICBicmVhaztcclxuICAgICAgLy8gICAgIGRlZmF1bHQ6XHJcbiAgICAgIC8vICAgICAgIHRoaXMuaGxzLmRlc3Ryb3koKTtcclxuICAgICAgLy8gICAgICAgYnJlYWs7XHJcbiAgICAgIC8vICAgfVxyXG4gICAgICAvLyB9KTtcclxuICAgIH1cclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiZmluaXNoZWQgYXR0YWNoIG1lZGlhXCIpO1xyXG4gICAgLy8gIGVsc2UgaWYgKHRoaXMuYXVkaW8uY2FuUGxheVR5cGUoXCJhcHBsaWNhdGlvbi92bmQuYXBwbGUubXBlZ3VybFwiKSkge1xyXG4gICAgLy8gICB0aGlzLmF1ZGlvLnNyYyA9IHRoaXMuYXVkaW9PYmplY3QuZmlsZTtcclxuICAgIC8vICAgaWYgKFV0aWxzLmlzSU9TKCkpIHtcclxuICAgIC8vICAgICBmcHNfZHJtLmluaXQoXHJcbiAgICAvLyAgICAgICB0aGlzLmF1ZGlvLFxyXG4gICAgLy8gICAgICAgY29uZmlnLmZwc0NlcnRpZmljYXRlVXJsLFxyXG4gICAgLy8gICAgICAgdGhpcy5hdWRpb09iamVjdC5hc3NldElkXHJcbiAgICAvLyAgICAgKTtcclxuICAgIC8vICAgfVxyXG4gICAgLy8gICB0aGlzLmF1ZGlvLnBsYXlzSW5saW5lID0gdHJ1ZTtcclxuICAgIC8vICAgdGhpcy5zdGFydCgpO1xyXG4gICAgLy8gfVxyXG4gIH1cclxuICBmYWtlaW5pdCgpIHtcclxuICAgIGNvbnN0IGNvbnRleHQgPSBjYXN0LmZyYW1ld29yay5DYXN0UmVjZWl2ZXJDb250ZXh0LmdldEluc3RhbmNlKCk7XHJcbiAgICBjb25zdCBwbGF5ZXJNYW5hZ2VyID0gY29udGV4dC5nZXRQbGF5ZXJNYW5hZ2VyKCk7XHJcbiAgICB0aGlzLmNhc3REZWJ1Z0xvZ2dlciA9IHtcclxuICAgICAgZGVidWc6IGZ1bmN0aW9uICh0eXBlLCBtZXNzYWdlKSB7XHJcbiAgICAgICAgY29uc29sZS5kZWJ1Zyh0eXBlLCBtZXNzYWdlKTtcclxuICAgICAgfSxcclxuICAgIH07XHJcbiAgICB0aGlzLnJlY2VpdmVyQ29udHJvbHMuc2V0Q2FzdERlYnVnZ2VyKHRoaXMuY2FzdERlYnVnTG9nZ2VyKTtcclxuICAgIHRoaXMuYXVkaW9PYmplY3QuZmlsZSA9XHJcbiAgICAgIFwiaHR0cHM6Ly92cC5namlyYWZhLm5ldC92cHMvcHJvZC9vZGdlaHR5by9lbmNvZGUvdmpzbXlsZHMvbXAzLzM2MHAubXAzXCI7XHJcbiAgICB0aGlzLmF0dGFjaE1lZGlhKCk7XHJcbiAgICB0aGlzLmJpbmRNZXRob2RzKCk7XHJcbiAgICAvLyB0aGlzLmJpbmRJbnRlcmNlcHRvcnMoKTtcclxuICAgIHRoaXMuYWRkUGxheWVyRXZlbnRzKCk7XHJcbiAgICBjb250ZXh0LnN0YXJ0KCk7XHJcbiAgfVxyXG4gIGluaXQoKSB7XHJcbiAgICB0aGlzLmNvbnRleHQgPSBjYXN0LmZyYW1ld29yay5DYXN0UmVjZWl2ZXJDb250ZXh0LmdldEluc3RhbmNlKCk7XHJcblxyXG4gICAgdGhpcy5jb250ZXh0LnNldExvZ2dlckxldmVsKGNhc3QuZnJhbWV3b3JrLkxvZ2dlckxldmVsLkRFQlVHKTtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlciA9IHRoaXMuY29udGV4dC5nZXRQbGF5ZXJNYW5hZ2VyKCk7XHJcbiAgICB0aGlzLnBsYXllck1hbmFnZXIuc2V0TWVkaWFFbGVtZW50KHRoaXMuYXVkaW8pO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIgPSBjYXN0LmRlYnVnLkNhc3REZWJ1Z0xvZ2dlci5nZXRJbnN0YW5jZSgpO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuc2V0RW5hYmxlZCh0cnVlKTtcclxuICAgIHRoaXMuY2FzdERlYnVnTG9nZ2VyLmRlYnVnKFwiaGVsbG9cIiwgXCJva2VqXCIpO1xyXG5cclxuICAgIHRoaXMucmVjZWl2ZXJDb250cm9scy5zZXRDYXN0RGVidWdnZXIodGhpcy5jYXN0RGVidWdMb2dnZXIpO1xyXG4gICAgLy8gdGhpcy5wbGF5YmFja0NvbmZpZy5hdXRvUmVzdW1lRHVyYXRpb24gPSA1O1xyXG4gICAgLy8gdGhpcy5jYXN0RGVidWdMb2dnZXIuaW5mbyhMT0dfUkVDRUlWRVJfVEFHLCBgYXV0b2luaXQ6IGApO1xyXG4gICAgLy8gdGhpcy5jb250cm9scy5jbGVhckRlZmF1bHRTbG90QXNzaWdubWVudHMoKTtcclxuICAgIC8vIHRoaXMuZHJhd0J1dHRvbnMoKTtcclxuXHJcbiAgICAvLyBjb250ZXh0LnN0YXJ0KHtcclxuICAgIC8vICAgcXVldWU6IG5ldyBDYXN0UXVldWUoKSxcclxuICAgIC8vICAgcGxheWJhY2tDb25maWc6IHRoaXMucGxheWJhY2tDb25maWcsXHJcbiAgICAvLyAgIHN1cHBvcnRlZENvbW1hbmRzOlxyXG4gICAgLy8gICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkNvbW1hbmQuQUxMX0JBU0lDX01FRElBIHxcclxuICAgIC8vICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5Db21tYW5kLlFVRVVFX1BSRVYgfFxyXG4gICAgLy8gICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkNvbW1hbmQuUVVFVUVfTkVYVCB8XHJcbiAgICAvLyAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuQ29tbWFuZC5TVFJFQU1fVFJBTlNGRVIsXHJcbiAgICAvLyB9KTtcclxuICAgIC8vIHRoaXMuYmluZEludGVyY2VwdG9ycygpO1xyXG4gICAgLy8gdGhpcy5hdWRpb09iamVjdC5maWxlID1cclxuICAgIC8vICAgXCJodHRwczovL3ZwLmdqaXJhZmEubmV0L3Zwcy9wcm9kL29kZ2VodHlvL2VuY29kZS92anNteWxkcy9tcDMvMzYwcC5tcDNcIjtcclxuICAgIC8vIHRoaXMuYXR0YWNoTWVkaWEoKTtcclxuICAgIHRoaXMuY29udGV4dC5zdGFydCgpO1xyXG4gICAgdGhpcy5iaW5kTWV0aG9kcygpO1xyXG4gICAgdGhpcy5iaW5kSW50ZXJjZXB0b3JzKCk7XHJcbiAgICB0aGlzLmFkZFBsYXllckV2ZW50cygpO1xyXG4gIH1cclxuICBvblNlZWsocmVxdWVzdERhdGEpIHtcclxuICAgIHRoaXMuYXVkaW8uY3VycmVudFRpbWUgPSByZXF1ZXN0RGF0YS5jdXJyZW50VGltZTtcclxuICAgIHRoaXMucmVjZWl2ZXJDb250cm9scy5zaG93Q29udHJvbHMoKTtcclxuICAgIHRoaXMucmVjZWl2ZXJDb250cm9scy5oaWRlQ29udHJvbHMoNjAwMCk7XHJcblxyXG4gICAgdGhpcy5yZWNlaXZlckNvbnRyb2xzLnVwZGF0ZSh0aGlzLnVwZGF0ZVBsYXllclN0YXRlKCkpO1xyXG4gIH1cclxuICBkcmF3QnV0dG9ucygpIHtcclxuICAgIHRoaXMuY29udHJvbHMuYXNzaWduQnV0dG9uKFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc1Nsb3QuU0xPVF9TRUNPTkRBUllfMSxcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNCdXR0b24uUVVFVUVfUFJFVlxyXG4gICAgKTtcclxuICAgIHRoaXMuY29udHJvbHMuYXNzaWduQnV0dG9uKFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc1Nsb3QuU0xPVF9QUklNQVJZXzEsXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzQnV0dG9uLkNBUFRJT05TXHJcbiAgICApO1xyXG4gICAgdGhpcy5jb250cm9scy5hc3NpZ25CdXR0b24oXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzU2xvdC5TTE9UX1BSSU1BUllfMixcclxuICAgICAgY2FzdC5mcmFtZXdvcmsudWkuQ29udHJvbHNCdXR0b24uU0VFS19GT1JXQVJEXzE1XHJcbiAgICApO1xyXG4gICAgdGhpcy5jb250cm9scy5hc3NpZ25CdXR0b24oXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLnVpLkNvbnRyb2xzU2xvdC5TTE9UX1NFQ09OREFSWV8yLFxyXG4gICAgICBjYXN0LmZyYW1ld29yay51aS5Db250cm9sc0J1dHRvbi5RVUVVRV9ORVhUXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYmluZEludGVyY2VwdG9ycygpIHtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlci5zZXRNZXNzYWdlSW50ZXJjZXB0b3IoXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLk1lc3NhZ2VUeXBlLkxPQUQsXHJcbiAgICAgIHRoaXMub25Mb2FkUmVxdWVzdC5iaW5kKHRoaXMpXHJcbiAgICApO1xyXG4gICAgdGhpcy5wbGF5ZXJNYW5hZ2VyLnNldE1lc3NhZ2VJbnRlcmNlcHRvcihcclxuICAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuTWVzc2FnZVR5cGUuUExBWSxcclxuICAgICAgdGhpcy5vblBsYXkuYmluZCh0aGlzKVxyXG4gICAgKTtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlci5zZXRNZXNzYWdlSW50ZXJjZXB0b3IoXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLk1lc3NhZ2VUeXBlLlBBVVNFLFxyXG4gICAgICB0aGlzLm9uUGF1c2UuYmluZCh0aGlzKVxyXG4gICAgKTtcclxuICAgIHRoaXMucGxheWVyTWFuYWdlci5zZXRNZXNzYWdlSW50ZXJjZXB0b3IoXHJcbiAgICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLk1lc3NhZ2VUeXBlLlNFRUssXHJcbiAgICAgIHRoaXMub25TZWVrLmJpbmQodGhpcylcclxuICAgICk7XHJcbiAgfVxyXG4gIGJpbmRNZXRob2RzKCkge1xyXG4gICAgdGhpcy5iaW5kSW50ZXJjZXB0b3JzID0gdGhpcy5iaW5kSW50ZXJjZXB0b3JzLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLm9uTG9hZFJlcXVlc3QgPSB0aGlzLm9uTG9hZFJlcXVlc3QuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuYXR0YWNoTWVkaWEgPSB0aGlzLmF0dGFjaE1lZGlhLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnN0YXJ0ID0gdGhpcy5zdGFydC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5hZGRQbGF5ZXJFdmVudHMgPSB0aGlzLmFkZFBsYXllckV2ZW50cy5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vblRpbWVVcGRhdGUgPSB0aGlzLm9uVGltZVVwZGF0ZS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vblBsYXkgPSB0aGlzLm9uUGxheS5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5vblBhdXNlID0gdGhpcy5vblBhdXNlLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLnVwZGF0ZVBsYXllclN0YXRlID0gdGhpcy51cGRhdGVQbGF5ZXJTdGF0ZS5iaW5kKHRoaXMpO1xyXG4gIH1cclxuICBvbkxvYWRSZXF1ZXN0KGxvYWRSZXF1ZXN0RGF0YSkge1xyXG4gICAgLy8gSWYgdGhlIGxvYWRSZXF1ZXN0RGF0YSBpcyBpbmNvbXBsZXRlIHJldHVybiBhbiBlcnJvciBtZXNzYWdlXHJcbiAgICAvLyBpZiAoIWxvYWRSZXF1ZXN0RGF0YSB8fCAhbG9hZFJlcXVlc3REYXRhLm1lZGlhKSB7XHJcbiAgICAvLyAgIGNvbnN0IGVycm9yID0gbmV3IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yRGF0YShcclxuICAgIC8vICAgICBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvclR5cGUuTE9BRF9GQUlMRURcclxuICAgIC8vICAgKTtcclxuICAgIC8vICAgZXJyb3IucmVhc29uID0gY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JSZWFzb24uSU5WQUxJRF9SRVFVRVNUO1xyXG4gICAgLy8gICByZXR1cm4gZXJyb3I7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy8gLy8gY2hlY2sgYWxsIGNvbnRlbnQgc291cmNlIGZpZWxkcyBmb3IgYXNzZXQgVVJMIG9yIElEXHJcbiAgICAvLyBsZXQgc291cmNlID1cclxuICAgIC8vICAgbG9hZFJlcXVlc3REYXRhLm1lZGlhLmNvbnRlbnRVcmwgfHxcclxuICAgIC8vICAgbG9hZFJlcXVlc3REYXRhLm1lZGlhLmVudGl0eSB8fFxyXG4gICAgLy8gICBsb2FkUmVxdWVzdERhdGEubWVkaWEuY29udGVudElkO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJWUHJlY2VpdmVyXCIsIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5jb250ZW50SWQpO1xyXG4gICAgdGhpcy5jYXN0RGVidWdMb2dnZXIuZGVidWcoXCJWUHJlY2VpdmVyMVwiLCBIbHMuaXNTdXBwb3J0ZWQoKSk7XHJcbiAgICB0aGlzLmF1ZGlvT2JqZWN0LmZpbGUgPSBsb2FkUmVxdWVzdERhdGEubWVkaWEuY29udGVudElkO1xyXG4gICAgdGhpcy5hdWRpb09iamVjdC5kdXJhdGlvbiA9IGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5tZXRhZGF0YS5kdXJhdGlvbjtcclxuICAgIHRoaXMuY3VycmVudFRpbWUgPSBsb2FkUmVxdWVzdERhdGEuY3VycmVudFRpbWU7XHJcbiAgICB0aGlzLnBsYXliYWNrUmF0ZSA9IGxvYWRSZXF1ZXN0RGF0YS5wbGF5YmFja1JhdGU7XHJcbiAgICB0aGlzLmF1dG9wbGF5ID0gbG9hZFJlcXVlc3REYXRhLmF1dG9wbGF5O1xyXG4gICAgdGhpcy5hdHRhY2hNZWRpYSgpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgICAvLyBJZiB0aGVyZSBpcyBubyBzb3VyY2Ugb3IgYSBtYWxmb3JtZWQgSUQgdGhlbiByZXR1cm4gYW4gZXJyb3IuXHJcbiAgICBpZiAoIXNvdXJjZSB8fCBzb3VyY2UgPT0gXCJcIiB8fCAhc291cmNlLm1hdGNoKElEX1JFR0VYKSkge1xyXG4gICAgICBsZXQgZXJyb3IgPSBuZXcgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JEYXRhKFxyXG4gICAgICAgIGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkVycm9yVHlwZS5MT0FEX0ZBSUxFRFxyXG4gICAgICApO1xyXG4gICAgICBlcnJvci5yZWFzb24gPSBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvclJlYXNvbi5JTlZBTElEX1JFUVVFU1Q7XHJcbiAgICAgIHJldHVybiBlcnJvcjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgc291cmNlSWQgPSBzb3VyY2UubWF0Y2goSURfUkVHRVgpWzFdO1xyXG5cclxuICAgIC8vIEFkZCBicmVha3MgdG8gdGhlIG1lZGlhIGluZm9ybWF0aW9uIGFuZCBzZXQgdGhlIGNvbnRlbnRVcmxcclxuICAgIHJldHVybiBhZGRCcmVha3MobG9hZFJlcXVlc3REYXRhLm1lZGlhKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgLy8gSWYgdGhlIHNvdXJjZSBpcyBhIHVybCB0aGF0IHBvaW50cyB0byBhbiBhc3NldCBkb24ndCBmZXRjaCBmcm9tIGJhY2tlbmRcclxuICAgICAgICBpZiAoc291cmNlSWQuaW5jbHVkZXMoXCIuXCIpKSB7XHJcbiAgICAgICAgICBjYXN0RGVidWdMb2dnZXIuZGVidWcoXHJcbiAgICAgICAgICAgIExPR19SRUNFSVZFUl9UQUcsXHJcbiAgICAgICAgICAgIFwiSW50ZXJjZXB0b3IgcmVjZWl2ZWQgZnVsbCBVUkxcIlxyXG4gICAgICAgICAgKTtcclxuICAgICAgICAgIGxvYWRSZXF1ZXN0RGF0YS5tZWRpYS5jb250ZW50VXJsID0gc291cmNlO1xyXG4gICAgICAgICAgcmV0dXJuIGxvYWRSZXF1ZXN0RGF0YTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEZldGNoIHRoZSBjb250ZW50VXJsIGlmIHByb3ZpZGVkIGFuIElEIG9yIGVudGl0eSBVUkxcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhMT0dfUkVDRUlWRVJfVEFHLCBcIkludGVyY2VwdG9yIHJlY2VpdmVkIElEXCIpO1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hNZWRpYUJ5SWQoc291cmNlSWQpLnRoZW4oKGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgbGV0IG1ldGFkYXRhID0gbmV3IGNhc3QuZnJhbWV3b3JrLm1lc3NhZ2VzLkdlbmVyaWNNZWRpYU1ldGFkYXRhKCk7XHJcbiAgICAgICAgICAgIG1ldGFkYXRhLnRpdGxlID0gaXRlbS50aXRsZTtcclxuICAgICAgICAgICAgbWV0YWRhdGEuc3VidGl0bGUgPSBpdGVtLmRlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICBsb2FkUmVxdWVzdERhdGEubWVkaWEuY29udGVudElkID0gaXRlbS5zdHJlYW0uZGFzaDtcclxuICAgICAgICAgICAgbG9hZFJlcXVlc3REYXRhLm1lZGlhLmNvbnRlbnRUeXBlID0gXCJhcHBsaWNhdGlvbi9kYXNoK3htbFwiO1xyXG4gICAgICAgICAgICBsb2FkUmVxdWVzdERhdGEubWVkaWEubWV0YWRhdGEgPSBtZXRhZGF0YTtcclxuICAgICAgICAgICAgcmV0dXJuIGxvYWRSZXF1ZXN0RGF0YTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnJvck1lc3NhZ2UpID0+IHtcclxuICAgICAgICBsZXQgZXJyb3IgPSBuZXcgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JEYXRhKFxyXG4gICAgICAgICAgY2FzdC5mcmFtZXdvcmsubWVzc2FnZXMuRXJyb3JUeXBlLkxPQURfRkFJTEVEXHJcbiAgICAgICAgKTtcclxuICAgICAgICBlcnJvci5yZWFzb24gPSBjYXN0LmZyYW1ld29yay5tZXNzYWdlcy5FcnJvclJlYXNvbi5JTlZBTElEX1JFUVVFU1Q7XHJcbiAgICAgICAgY2FzdERlYnVnTG9nZ2VyLmVycm9yKExPR19SRUNFSVZFUl9UQUcsIGVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgcmV0dXJuIGVycm9yO1xyXG4gICAgICB9KTtcclxuICB9XHJcbiAgYWRkQnJlYWtzKG1lZGlhSW5mb3JtYXRpb24pIHtcclxuICAgIGNhc3REZWJ1Z0xvZ2dlci5kZWJ1ZyhcclxuICAgICAgTE9HX1JFQ0VJVkVSX1RBRyxcclxuICAgICAgXCJhZGRCcmVha3M6IFwiICsgSlNPTi5zdHJpbmdpZnkobWVkaWFJbmZvcm1hdGlvbilcclxuICAgICk7XHJcbiAgICByZXR1cm4gZmV0Y2hNZWRpYUJ5SWQoXCJmYmJfYWRcIikudGhlbigoY2xpcDEpID0+IHtcclxuICAgICAgbWVkaWFJbmZvcm1hdGlvbi5icmVha0NsaXBzID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGlkOiBcImZiYl9hZFwiLFxyXG4gICAgICAgICAgdGl0bGU6IGNsaXAxLnRpdGxlLFxyXG4gICAgICAgICAgY29udGVudFVybDogY2xpcDEuc3RyZWFtLmRhc2gsXHJcbiAgICAgICAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9kYXNoK3htbFwiLFxyXG4gICAgICAgICAgd2hlblNraXBwYWJsZTogNSxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbWVkaWFJbmZvcm1hdGlvbi5icmVha3MgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaWQ6IFwicHJlLXJvbGxcIixcclxuICAgICAgICAgIGJyZWFrQ2xpcElkczogW1wiZmJiX2FkXCJdLFxyXG4gICAgICAgICAgcG9zaXRpb246IDAsXHJcbiAgICAgICAgfSxcclxuICAgICAgXTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBmZXRjaE1lZGlhQnlJZChpZCkge1xyXG4gICAgY2FzdERlYnVnTG9nZ2VyLmRlYnVnKExPR19SRUNFSVZFUl9UQUcsIFwiZmV0Y2hpbmcgaWQ6IFwiICsgaWQpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgoYWNjZXB0LCByZWplY3QpID0+IHtcclxuICAgICAgZmV0Y2goQ09OVEVOVF9VUkwpXHJcbiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgLnRoZW4oKG9iaikgPT4ge1xyXG4gICAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICBpZiAob2JqW2lkXSkge1xyXG4gICAgICAgICAgICAgIGFjY2VwdChvYmpbaWRdKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZWplY3QoYCR7aWR9IG5vdCBmb3VuZCBpbiByZXBvc2l0b3J5YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlamVjdChcIkNvbnRlbnQgcmVwb3NpdG9yeSBub3QgZm91bmQuXCIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBSZWNlaXZlcjtcclxuIiwiaW1wb3J0IFNlZWtCYXIgZnJvbSBcIi4vc2Vla2JhclwiXHJcbmltcG9ydCBUaW1lciBmcm9tIFwiLi90aW1lclwiXHJcbmNsYXNzIFJlY2VpdmVyQ29udHJvbHMge1xyXG4gIGNvbnN0cnVjdG9yKGlkKSB7XHJcbiAgICB0aGlzLnNlZWtiYXIgPSBuZXcgU2Vla0JhcihcIi5zZWVrYmFyLXByb2dyZXNzXCIpXHJcbiAgICB0aGlzLnRpbWVyID0gbmV3IFRpbWVyKFwiLnRpbWVyXCIpXHJcbiAgICB0aGlzLmNhc3REZWJ1Z2dlciA9IG51bGxcclxuICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpXHJcbiAgICB0aGlzLnNob3cgPSB0cnVlXHJcbiAgICB0aGlzLmxvYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubG9hZGVyXCIpXHJcbiAgICB0aGlzLnBsYXlJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi52cC1pY29uLXBsYXlcIilcclxuICAgIHRoaXMucGF1c2VJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi52cC1pY29uLXBhdXNlXCIpXHJcbiAgfVxyXG4gIHNldENhc3REZWJ1Z2dlcihjYXN0RGVidWdnZXIpIHtcclxuICAgIHRoaXMuY2FzdERlYnVnZ2VyID0gY2FzdERlYnVnZ2VyXHJcbiAgICB0aGlzLnNlZWtiYXIuc2V0Q2FzdERlYnVnZ2VyKHRoaXMuY2FzdERlYnVnZ2VyKVxyXG4gIH1cclxuICBwYXVzZSgpIHtcclxuICAgIHRoaXMucGF1c2VJY29uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxyXG4gICAgdGhpcy5wbGF5SWNvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5wbGF5SWNvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCJcclxuICAgIH0sIDIwMDApXHJcbiAgfVxyXG4gIHBsYXkoKSB7XHJcbiAgICB0aGlzLnBsYXlJY29uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxyXG4gICAgdGhpcy5wYXVzZUljb24uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIlxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMucGF1c2VJY29uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxyXG4gICAgfSwgMjAwMClcclxuICB9XHJcbiAgdXBkYXRlKHN0YXRlKSB7XHJcbiAgICBjb25zb2xlLmxvZyhzdGF0ZSlcclxuICAgIHRoaXMuc2Vla2Jhci5zZXRQcm9ncmVzcyhzdGF0ZS5jdXJyZW50VGltZSwgc3RhdGUuZHVyYXRpb24pXHJcbiAgICB0aGlzLnRpbWVyLnVwZGF0ZShzdGF0ZS5jdXJyZW50VGltZSwgc3RhdGUuZHVyYXRpb24pXHJcbiAgfVxyXG4gIGhpZGVDb250cm9scyh0aW1lKSB7XHJcbiAgICB0aGlzLnNob3cgPSBmYWxzZVxyXG4gICAgdGhpcy5zaG93SGlkZSh0aW1lIHx8IDUwMDApXHJcbiAgfVxyXG4gIHNob3dDb250cm9scygpIHtcclxuICAgIHRoaXMuc2hvdyA9IHRydWVcclxuICAgIHRoaXMuc2hvd0hpZGUoMTApXHJcbiAgfVxyXG4gIHNob3dIaWRlKHRpbWluZykge1xyXG4gICAgLy8gdGhpcy5jYXN0ZGVidWdnZXIuZGVidWcoXCJzaG93SGlkZVwiLCBgJHt0aW1pbmd9ICR7dGhpcy5zaG93fWApO1xyXG4gICAgaWYgKHRoaXMuc2hvdykge1xyXG4gICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiXHJcbiAgICAgIH0sIHRpbWluZylcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFJlY2VpdmVyQ29udHJvbHNcclxuIiwiaW1wb3J0IFV0aWxzIGZyb20gXCIuLi9oZWxwZXJzL1V0aWxzXCI7XHJcblxyXG5jbGFzcyBUaW1lciB7XHJcbiAgY29uc3RydWN0b3IoaWQpIHtcclxuICAgIHRoaXMuZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoaWQpO1xyXG4gICAgdGhpcy5lbGVtZW50LnRleHRDb250ZW50ID0gXCIwMDowMCAvIDAwOjAwXCI7XHJcbiAgfVxyXG4gIHVwZGF0ZShjdXJyZW50VGltZSwgZHVyYXRpb24pIHtcclxuICAgIHRoaXMuZWxlbWVudC50ZXh0Q29udGVudCA9IGAke1V0aWxzLmZvcm1hdFRpbWUoXHJcbiAgICAgIGN1cnJlbnRUaW1lXHJcbiAgICApfSAvJHtVdGlscy5mb3JtYXRUaW1lKGR1cmF0aW9uKX1gO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVGltZXI7XHJcbiJdLCJuYW1lcyI6WyJ0aW1lIiwiaG91cnMiLCJNYXRoIiwiZmxvb3IiLCJtaW51dGVzIiwic2Vjb25kcyIsInRvU3RyaW5nIiwicGFkU3RhcnQiLCJ2cFJlY2VpdmVyIiwiaWQiLCJjb25maWciLCJyZWNlaXZlciIsImNvbnN0cnVjdG9yIiwidGhpcyIsImNvbnRleHQiLCJwbGF5ZXJNYW5hZ2VyIiwiY2FzdERlYnVnTG9nZ2VyIiwiYXBwSWQiLCJhdWRpbyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInBsYXliYWNrQ29uZmlnIiwiY29udHJvbHMiLCJobHMiLCJhdWRpb09iamVjdCIsImF1ZGlvQ29udGFpbmVyIiwicGFyZW50RWxlbWVudCIsInBsYXliYWNrUmF0ZSIsImF1dG9wbGF5IiwicmVjZWl2ZXJDb250cm9scyIsInNlZWtiYXIiLCJlbGVtZW50IiwiY2FzdGRlYnVnZ2VyIiwic2hvdyIsInNldENhc3REZWJ1Z2dlciIsInNldFByb2dyZXNzIiwiZHVyYXRpb24iLCJzdHlsZSIsIndpZHRoIiwic2hvd0hpZGUiLCJ0aW1pbmciLCJkZWJ1ZyIsImRpc3BsYXkiLCJzZXRUaW1lb3V0IiwidGltZXIiLCJ0ZXh0Q29udGVudCIsInVwZGF0ZSIsImN1cnJlbnRUaW1lIiwiVXRpbHMiLCJjYXN0RGVidWdnZXIiLCJsb2FkZXIiLCJwbGF5SWNvbiIsInBhdXNlSWNvbiIsInBhdXNlIiwicGxheSIsInN0YXRlIiwiY29uc29sZSIsImxvZyIsImhpZGVDb250cm9scyIsInNob3dDb250cm9scyIsIm1lZGlhTWFuYWdlciIsImNhc3RSZWNlaXZlck1hbmFnZXIiLCJhdWRpb1N0YXJ0ZWQiLCJzdGFydCIsIm9uUGxheSIsInRoZW4iLCJjYXRjaCIsIm9uUGF1c2UiLCJhZGRQbGF5ZXJFdmVudHMiLCJhZGRFdmVudExpc3RlbmVyIiwib25UaW1lVXBkYXRlIiwidXBkYXRlUGxheWVyU3RhdGUiLCJhdHRhY2hNZWRpYSIsIkhMU3N1cHBvcnRlZCIsIkhscyIsImlzU3VwcG9ydGVkIiwiSlNPTiIsInN0cmluZ2lmeSIsImZpbGUiLCJlbmRzV2l0aCIsInNyYyIsIm9uIiwiRXZlbnRzIiwiTUVESUFfQVRUQUNIRUQiLCJzdGFydExldmVsIiwibG9hZFNvdXJjZSIsIk1BTklGRVNUX1BBUlNFRCIsImV2ZW50IiwiZGF0YSIsIkVSUk9SIiwiZGV0YWlscyIsImVycm9yIiwiZmFrZWluaXQiLCJjYXN0IiwiZnJhbWV3b3JrIiwiQ2FzdFJlY2VpdmVyQ29udGV4dCIsImdldEluc3RhbmNlIiwiZ2V0UGxheWVyTWFuYWdlciIsInR5cGUiLCJtZXNzYWdlIiwiYmluZE1ldGhvZHMiLCJpbml0Iiwic2V0TG9nZ2VyTGV2ZWwiLCJMb2dnZXJMZXZlbCIsIkRFQlVHIiwic2V0TWVkaWFFbGVtZW50IiwiQ2FzdERlYnVnTG9nZ2VyIiwic2V0RW5hYmxlZCIsImJpbmRJbnRlcmNlcHRvcnMiLCJvblNlZWsiLCJyZXF1ZXN0RGF0YSIsImRyYXdCdXR0b25zIiwiYXNzaWduQnV0dG9uIiwidWkiLCJDb250cm9sc1Nsb3QiLCJTTE9UX1NFQ09OREFSWV8xIiwiQ29udHJvbHNCdXR0b24iLCJRVUVVRV9QUkVWIiwiU0xPVF9QUklNQVJZXzEiLCJDQVBUSU9OUyIsIlNMT1RfUFJJTUFSWV8yIiwiU0VFS19GT1JXQVJEXzE1IiwiU0xPVF9TRUNPTkRBUllfMiIsIlFVRVVFX05FWFQiLCJzZXRNZXNzYWdlSW50ZXJjZXB0b3IiLCJtZXNzYWdlcyIsIk1lc3NhZ2VUeXBlIiwiTE9BRCIsIm9uTG9hZFJlcXVlc3QiLCJiaW5kIiwiUExBWSIsIlBBVVNFIiwiU0VFSyIsImxvYWRSZXF1ZXN0RGF0YSIsIm1lZGlhIiwiY29udGVudElkIiwibWV0YWRhdGEiLCJhZGRCcmVha3MiLCJtZWRpYUluZm9ybWF0aW9uIiwiTE9HX1JFQ0VJVkVSX1RBRyIsImZldGNoTWVkaWFCeUlkIiwiY2xpcDEiLCJicmVha0NsaXBzIiwidGl0bGUiLCJjb250ZW50VXJsIiwic3RyZWFtIiwiZGFzaCIsImNvbnRlbnRUeXBlIiwid2hlblNraXBwYWJsZSIsImJyZWFrcyIsImJyZWFrQ2xpcElkcyIsInBvc2l0aW9uIiwiUHJvbWlzZSIsImFjY2VwdCIsInJlamVjdCIsImZldGNoIiwiQ09OVEVOVF9VUkwiLCJyZXNwb25zZSIsImpzb24iLCJvYmoiLCJ3aW5kb3ciXSwic291cmNlUm9vdCI6IiJ9